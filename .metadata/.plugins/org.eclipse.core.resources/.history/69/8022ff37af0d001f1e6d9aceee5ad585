package DAO;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import connect.ConnectDB;
import entity.KhachHang;
import entity.LoaiQuanAo;
import entity.NhaCungCap;
import entity.QuanAo;
import jakarta.persistence.EntityManager;
import jakarta.persistence.EntityTransaction;
import jakarta.persistence.Query;
import jakarta.persistence.TypedQuery;

public class DAO_KhachHang {
	private EntityManager entityManager;
	public DAO_KhachHang (EntityManager entityManager) {
		this.entityManager = entityManager;
	}
	List<KhachHang> dsKhachHang = new ArrayList<>();
	
	public List<KhachHang> getAllKhachHang() {
		Query query = entityManager.createQuery("SELECT kh FROM KhachHang kh");
		return query.getResultList();
	}
	public boolean themKH(KhachHang kh) {	
		EntityTransaction transaction = null;
		try  {
			transaction = entityManager.getTransaction();
			transaction.begin();
			entityManager.persist(kh);
			transaction.commit();
			return true;
		} catch (Exception e) {
			if (transaction != null) {
                transaction.rollback();
            }
            e.printStackTrace();
            return false;
		}
	}
	
	public boolean delete (String MaKH) {
		EntityTransaction transaction = null;
		try {
			transaction = entityManager.getTransaction();
			transaction.begin();
			KhachHang kh = entityManager.find(KhachHang.class, MaKH);
			if (kh != null) {
				entityManager.remove(kh);
				transaction.commit();
				return true;
			}
			return false;
		} catch (Exception e) {
        if (transaction != null) {
            transaction.rollback();
        }
        e.printStackTrace();
        return false;
    }
	}
	
	public boolean update( KhachHang kh) {
		EntityTransaction transaction = null;
		try {
			transaction = entityManager.getTransaction();
			transaction.begin();
			entityManager.merge(kh);
			transaction.commit();
			return true;
		} catch (Exception e) {
            if (transaction != null) {
                transaction.rollback();
            }
            e.printStackTrace();
            return false;
        }
	}
	
//	public ArrayList<KhachHang> timTheoSoDienThoai(String sdt) {
//		TypedQuery<KhachHang> query = entityManager.createQuery("SELECT kh FROM KhachHang kh WHERE kh.SoDienThoai= :sdt");
//		query.setParameter("sdt", sdt);
//		return ArrayList<>(query.getResultList());
//	}
    public ArrayList<KhachHang> timTheoSoDienThoai(String sdt) {
        // Sá»­ dá»¥ng TypedQuery Ä‘á»ƒ trÃ¡nh cáº£nh bÃ¡o unchecked cast
        TypedQuery<KhachHang> query = entityManager.createQuery(
            "SELECT kh FROM KhachHang kh WHERE kh.SoDienThoai = :sdt", KhachHang.class);
        query.setParameter("sdt", sdt);
        List<KhachHang> resultList = query.getResultList();
        return new ArrayList<>(resultList); // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList
    }
	
	public ArrayList<KhachHang> timTheoTen(String ten) {
		TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.HoTen = :ten", KhachHang.class);
	        query.setParameter("ten", ten);
	        List<KhachHang> resultList = query.getResultList();
	        return new ArrayList<>(resultList);
	}
	
	public ArrayList<KhachHang> timTheoMa(String ma) {
		TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.MaKH = :ma", KhachHang.class);
	        query.setParameter("ma", ma);
	        List<KhachHang> resultList = query.getResultList();
	        return new ArrayList<>(resultList);
	}
	
	public ArrayList<KhachHang> timTheoGioiTinh(String gioitinh) {
		TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.GioiTinh = :gt", KhachHang.class);
	        query.setParameter("gt", gioitinh);
	        List<KhachHang> resultList = query.getResultList();
	        return new ArrayList<>(resultList);
		}
	
	 public ArrayList<KhachHang> timTheoTenvaGioiTinh(String ten, String gioitinh) {
	        // Táº¡o truy váº¥n JPA Ä‘á»ƒ tÃ¬m khÃ¡ch hÃ ng dá»±a trÃªn tÃªn vÃ  giá»›i tÃ­nh
	        TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.HoTen = :ten AND kh.GioiTinh = :gioitinh", KhachHang.class);
	        query.setParameter("ten", ten);
	        query.setParameter("gioitinh", gioitinh);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	    }
	
	public ArrayList<KhachHang> timTheoTenvaMa(String ten, String ma) {
		TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.HoTen = :ten AND kh.MaKH = :ma", KhachHang.class);
	        query.setParameter("ten", ten);
	        query.setParameter("ma", ma);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	}
	
	public ArrayList<KhachHang> timTheoTenvaSDT(String ten, String sdt) {
		TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.HoTen = :ten AND kh.SoDienThoai = :sdt", KhachHang.class);
	        query.setParameter("ten", ten);
	        query.setParameter("sdt", sdt);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	}
	
	public ArrayList<KhachHang> timTheogioivaMa(String gioitinh, String ma) {
		TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.GioiTinh = :gioitinh AND kh.MaKH = :ma ", KhachHang.class);
	       
	        query.setParameter("gioitinh", gioitinh);
	        query.setParameter("ma", ma);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	}
	public ArrayList<KhachHang> timTheoSDTvaMa(String sdt, String ma) {
		TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.SoDienThoai = :sdt AND kh.MaKH = :ma ", KhachHang.class);
	       
	        query.setParameter("sdt", sdt);
	        query.setParameter("ma", ma);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	}
	
	public ArrayList<KhachHang> timTheoSDTvaGioiTinh(String sdt, String gioitinh) {
		TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.SoDienThoai = :sdt AND kh.GioiTinh = :gt ", KhachHang.class);
	       
	        query.setParameter("sdt", sdt);
	        query.setParameter("gt", gioitinh);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	}
	
	 public ArrayList<KhachHang> timTheoTenvaGioiTinhvaMa(String ten, String gioitinh, String ma) {
	        // Táº¡o truy váº¥n JPA Ä‘á»ƒ tÃ¬m khÃ¡ch hÃ ng dá»±a trÃªn tÃªn, giá»›i tÃ­nh vÃ  mÃ£
	        TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.HoTen = :ten AND kh.GioiTinh = :gioitinh AND kh.MaKH = :ma", KhachHang.class);
	        query.setParameter("ten", ten);
	        query.setParameter("gioitinh", gioitinh);
	        query.setParameter("ma", ma);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	    }
	
	 public ArrayList<KhachHang> timTheoTenvaSDTvaMa(String ten, String sdt, String ma) {
	        // Táº¡o truy váº¥n JPA Ä‘á»ƒ tÃ¬m khÃ¡ch hÃ ng dá»±a trÃªn tÃªn, sá»‘ Ä‘iá»‡n thoáº¡i vÃ  mÃ£
	        TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.HoTen = :ten AND kh.SoDienThoai = :sdt AND kh.MaKH = :ma", KhachHang.class);
	        query.setParameter("ten", ten);
	        query.setParameter("sdt", sdt);
	        query.setParameter("ma", ma);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	    }
	
	 public ArrayList<KhachHang> timTheoSDTvaMavaGioiTinh(String sdt, String ma, String gioitinh) {
	        // Táº¡o truy váº¥n JPA Ä‘á»ƒ tÃ¬m khÃ¡ch hÃ ng dá»±a trÃªn sá»‘ Ä‘iá»‡n thoáº¡i, mÃ£ vÃ  giá»›i tÃ­nh
	        TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.SoDienThoai = :sdt AND kh.MaKH = :ma AND kh.GioiTinh = :gioitinh", KhachHang.class);
	        query.setParameter("sdt", sdt);
	        query.setParameter("ma", ma);
	        query.setParameter("gioitinh", gioitinh);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	    }
	 public ArrayList<KhachHang> timTheoTenvaGioiTinhvaMavaSDT(String ten, String gioitinh, String ma, String sdt) {
	        // Táº¡o truy váº¥n JPA Ä‘á»ƒ tÃ¬m khÃ¡ch hÃ ng dá»±a trÃªn tÃªn, giá»›i tÃ­nh, mÃ£ vÃ  sá»‘ Ä‘iá»‡n thoáº¡i
	        TypedQuery<KhachHang> query = entityManager.createQuery(
	            "SELECT kh FROM KhachHang kh WHERE kh.HoTen = :ten AND kh.GioiTinh = :gioitinh AND kh.MaKH = :ma AND kh.SoDienThoai = :sdt", KhachHang.class);
	        query.setParameter("ten", ten);
	        query.setParameter("gioitinh", gioitinh);
	        query.setParameter("ma", ma);
	        query.setParameter("sdt", sdt);

	        // Láº¥y danh sÃ¡ch káº¿t quáº£
	        List<KhachHang> resultList = query.getResultList();

	        // Chuyá»ƒn Ä‘á»•i List thÃ nh ArrayList vÃ  tráº£ vá»
	        return new ArrayList<>(resultList);
	    }
	public KhachHang getKhachHang(String maKH) {
		return entityManager.find(KhachHang.class, maKH);
	}

}

	


